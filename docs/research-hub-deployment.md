# Research Hub Deployment Guide

**Version:** 0.1  
**Last Updated:** 2026-02-20  
**Status:** Ready for deployment

---

## Overview

The Research Hub is a Next.js 15 web application that provides a browsable interface for research reports generated by the workspace research agents. It's located at `apps/research-hub/` and uses Tailwind CSS for styling.

The deployment process creates a standalone GitHub repository and links it to Vercel for automatic deployments. This keeps the Research Hub separate from the main workspace while still pulling content from the `research/` directory via a prebuild step.

---

## Prerequisites

Before deploying, ensure the following are installed and configured:

### 1. System Packages
- **Node.js** (v18+ recommended) — for building Next.js app
- **Git** — already installed and configured
- **GitHub CLI (`gh`)** — for creating the repo and pushing
- **Vercel CLI (`vercel`)** — for deploying to Vercel

The workspace already has these installed at:
- `gh`: `/usr/bin/gh`
- `vercel`: `/home/ubuntu/.npm-global/bin/vercel`
- `npm`: `/usr/bin/npm`

### 2. Permissions (OpenClaw Allowlist)

The OpenClaw Gateway must permit execution of `gh` and `vercel`. These have been added to `~/.openclaw/exec-approvals.json` as of 2026-02-20. **A gateway restart is required for changes to take effect.**

Verify with:
```bash
grep -E '"gh"|"vercel"' ~/.openclaw/exec-approvals.json
```

Expected output: entries with patterns `/usr/bin/gh` and `/home/ubuntu/.npm-global/bin/vercel`.

### 3. GitHub Authentication
```bash
gh auth status
```
If not authenticated, run:
```bash
gh auth login
```
Choose GitHub.com, HTTPS, and authenticate via browser.

### 4. Vercel Authentication
```bash
vercel whoami
```
If not authenticated:
```bash
vercel login
```
Follow the browser-based login flow.

---

## Deployment Steps

### Option A: Automated (via quick command)

After satisfying prerequisites:
```bash
./quick research-hub-deploy
```

This runs `apps/research-hub/setup-standalone-repo.sh` which will:
1. Copy Research Hub files to `/tmp/research-hub-standalone`
2. Run prebuild to copy `research/` markdown files into `public/research`
3. Initialize a new git repo and create initial commit
4. Create GitHub repo `research-hub` under your account (public)
5. Push to GitHub
6. Print instructions for Vercel linking

### Option B: Manual

```bash
cd /home/ubuntu/.openclaw/workspace/apps/research-hub
./setup-standalone-repo.sh
```

Follow the on-screen instructions.

---

## Vercel Deployment

After the standalone repo is created and pushed:

1. **Link Vercel project** (run once):
   ```bash
   cd /tmp/research-hub-standalone   # or wherever the script placed it
   vercel link --project research-hub
   ```
   Choose the same team/account as your GitHub repo. Vercel will create a project named `research-hub`.

2. **Production deployment**:
   ```bash
   vercel --prod
   ```
   This builds and deploys to production. Vercel will provide a URL like `https://research-hub.vercel.app`.

3. **Automatic deployments**: After linking, pushing to GitHub `main` branch will automatically trigger a production deployment (if configured). You can also enable preview deployments for PRs.

---

## Verification

### Local Build
From the workspace Research Hub directory:
```bash
cd apps/research-hub
npm run build
```
Should complete without errors. The output `.next` directory is created.

### Prebuild Check
The prebuild script copies research files:
```bash
cd apps/research-hub
bash prebuild.sh
```
After running, `public/research/` should contain all markdown files from `../research/`.

### Remote Deployment
Visit your production URL (e.g., `https://research-hub.vercel.app`). You should see:
- A header with title "Research Hub"
- A list of research reports (from `research/` directory)
- Individual report pages with rendered markdown content

Use `quick research-hub-status` to see current status:
```bash
./quick research-hub-status
```

---

## Maintenance

### Updating Content

Research reports are generated by the research-agent in the main workspace. To update the Research Hub:

1. Ensure new research files are present in `research/`.
2. Re-run prebuild locally to test:
   ```bash
   cd apps/research-hub
   bash prebuild.sh
   ```
3. Commit changes to the standalone repo (if you made local edits; normally prebuild output is ignored via .gitignore but the standalone repo uses the prebuilt `public/research` as tracked content).
4. Push to GitHub:
   ```bash
   git add public/research/
   git commit -m "Update research content"
   git push origin main
   ```
   Vercel will automatically redeploy.

Alternatively, you can set up a script to automate this sync from the main workspace to the standalone repo, but that's future work.

### Re-deploying after Code Changes

If you modify the Research Hub code (components, pages, styles):

1. Commit changes in the standalone repo.
2. Push to GitHub.
3. Vercel will detect changes and redeploy.

If you want to test locally:
```bash
cd apps/research-hub
npm run dev
```
Then visit `http://localhost:3000`.

### Uninstalling / Removing

To remove the deployment:
- Delete the GitHub repo: `gh repo delete defmarshal/research-hub`
- Delete the Vercel project: `vercel rm research-hub`
- Remove local standalone clone if desired

The `apps/research-hub/` directory in the workspace remains as the source.

---

## Troubleshooting

### `gh` or `vercel` command not permitted by OpenClaw
- Ensure gateway has been restarted after allowlist update.
- Check `~/.openclaw/exec-approvals.json` contains entries for these binaries.
- If still blocked, contact system administrator.

### `vercel` reports "No project linked"
Run `vercel link` in the deployed repo directory to associate with a Vercel project.

### Build fails on Vercel
Check Vercel build logs in the dashboard. Common issues:
- Node.js version mismatch (set in `package.json` engines)
- Missing dependencies (all should be in `package.json`)
- Environment variables (none currently needed)

### Content not updating
Remember: prebuild must be run to copy research files into `public/research` before committing. The standalone repo does not include the workspace `research/` directory directly; it includes the copied output.

If you manually edit files in `public/research`, they will be overwritten by prebuild next time. Only commit the copied files.

### Old research files still appear
Delete stale files from `public/research` manually if you remove them from workspace `research/`, then commit the deletion. Prebuild only copies/updates; it does not remove obsolete files automatically.

---

## Architecture Notes

- **Source of truth:** Workspace `research/` directory (workspace repo)
- **Build step:** `prebuild.sh` copies research markdown to `public/research`
- **Deployment target:** Vercel (serverless Next.js)
- **Repository:** Standalone `research-hub` repo on GitHub (separate from main workspace)
- **Content updates:** Require committing copied files to standalone repo; Vercel auto-deploys on push to `main`

This separation allows independent evolution of the Research Hub frontend without affecting the main workspace, while still consuming research content automatically.

---

## Future Enhancements

- Auto-sync script that watches `research/` and updates standalone repo automatically (maybe via cron)
- Live demo link in workspace README or dashboard
- Add search functionality across research reports
- Add tags/categorization UI
- Add analytics

---

**Questions?** Check `lessons.md` and `MEMORY.md` for system-specific notes.
