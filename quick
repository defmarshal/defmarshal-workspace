#!/usr/bin/env bash
# Quick launcher for common workspace utilities
# Usage: quick <command> [args...]

set -euo pipefail

WORKSPACE="/home/ubuntu/.openclaw/workspace"

show_help() {
  cat <<EOF
Quick workspace utility launcher

Commands:
  dash            Run the CLI dashboard (dashboard.py)
  web             Run the web dashboard (web-dashboard.py)
  mem             Show recent memories (claw memory list)
  search <query>  Search memories (claw memory search)
  health          Show workspace health summary (workspace-health)
  holidays        Show upcoming Indonesian holidays (show-holidays)
  git-status      Show brief git status
  anime <cmd>     Anime companion: search, info, top, season, upcoming
                  Example: quick anime search "frieren" [--tts]
  selfie [caption] [rating]  Send a random anime image via Nekos API.
                  rating: safe (default) or explicit. Caption optional.
  selfie-batch <count> [rating] [caption]  Fetch multiple anime images (1-20) and
                  send as a single zip file. Default count=5, rating=safe.
  log <category> "<message>"  Log an event to openclaw-memory (category: decision, learning, event, note, etc.)
  email-clean [options]      Auto-clean Gmail: archive promotional emails and apply labels.
                              Options: --execute (apply changes), --max N, --query "gmail query"
                              Rules: archives CATEGORY_PROMOTIONS/UPDATES, spammy keywords/senders,
                                    and labels messages containing keywords like "welcome" with configurable labels.
  help                       Show this help message

Examples:
  quick dash
  quick search "project"
  quick health
  quick anime info 52991 --tts
EOF
}

cmd="${1:-help}"
shift || true

case "$cmd" in
  dash|dashboard)
    python3 "$WORKSPACE/dashboard.py"
    ;;
  web)
    python3 "$WORKSPACE/web-dashboard.py"
    ;;
  mem|memory)
    /home/ubuntu/.npm-global/bin/openclaw memory search "recent" --max-results 20 --json
    ;;
  search)
    query="${1:-}"
    if [ -z "$query" ]; then
      echo "Error: search requires a query string" >&2
      echo "Usage: quick search <query>" >&2
      exit 1
    fi
    /home/ubuntu/.npm-global/bin/openclaw memory search "$query" --max-results 10 --json
    ;;
  health)
    python3 "$WORKSPACE/workspace-health.py" 2>/dev/null || "$WORKSPACE/workspace-health"
    ;;
  holidays)
    python3 "$WORKSPACE/show-holidays" 2>/dev/null || "$WORKSPACE/show-holidays"
    ;;
  git-status)
    git -C "$WORKSPACE" status --short
    ;;
  anime)
    "$WORKSPACE/anime-companion" "$@"
    ;;
  selfie)
    # Send a random anime image via Nekos API
    # Usage: quick selfie [caption] [rating]
    # Rating: safe (default) or explicit
    caption="${1:-}"
    rating="${2:-safe}"
    if [ "$rating" != "safe" ] && [ "$rating" != "explicit" ]; then
      echo "Error: rating must be 'safe' or 'explicit'" >&2
      exit 1
    fi
    # Use credentials from environment or openclaw.json (already set by gateway)
    "$WORKSPACE/skills/clawaifu-selfie/grok-selfie.sh" "$caption" "$rating"
    ;;
  selfie-batch)
    # Send multiple anime images as a zip via Nekos API
    # Usage: quick selfie-batch <count> [rating] [caption]
    # count: 1-20 (default: 5)
    # rating: safe (default) or explicit
    count="${1:-5}"
    rating="${2:-safe}"
    shift 2 || true
    caption="${*:-}"
    "$WORKSPACE/skills/clawaifu-selfie/grok-selfie-batch.sh" "$count" "$rating" "$caption"
    ;;
  log)
    "$WORKSPACE/log-event" "$@"
    ;;
  email-clean)
    python3 "$WORKSPACE/email-cleaner.py" "$@"
    ;;
  help|--help|-h)
    show_help
    ;;
  *)
    echo "Error: Unknown command '$cmd'" >&2
    echo "Run 'quick help' for available commands." >&2
    exit 1
    ;;
esac
