#!/usr/bin/env bash
# Quick launcher for common workspace utilities
# Usage: quick <command> [args...]

set -euo pipefail

WORKSPACE="/home/ubuntu/.openclaw/workspace"

show_help() {
  cat <<EOF
Quick workspace utility launcher

Commands:
  dash            Run the CLI dashboard (dashboard.py)
  web             Run the web dashboard (web-dashboard.py)
  mem             Show today's or latest memory file (today-mem)
  search <query>  Search memory files (msearch)
  health          Show workspace health summary (workspace-health)
  holidays        Show upcoming Indonesian holidays (show-holidays)
  git-status      Show brief git status
  anime <cmd>     Anime companion: search, info, top, season, upcoming
                  Example: quick anime search "frieren" [--tts]
  log <category> "<message>"  Log an event to today's memory file (category: decision, learning, event, note, etc.)
  summarize [date]           Generate a daily summary of memory entries (default: today)
  email-clean [options]      Auto-clean Gmail: archive promotional emails and apply labels.
                              Options: --execute (apply changes), --max N, --query "gmail query"
                              Rules: archives CATEGORY_PROMOTIONS/UPDATES, spammy keywords/senders,
                                    and labels messages containing keywords like "welcome" with configurable labels.
  help                       Show this help message

Examples:
  quick dash
  quick search "project"
  quick health
  quick anime info 52991 --tts
EOF
}

cmd="${1:-help}"
shift || true

case "$cmd" in
  dash|dashboard)
    python3 "$WORKSPACE/dashboard.py"
    ;;
  web)
    python3 "$WORKSPACE/web-dashboard.py"
    ;;
  mem|memory)
    python3 "$WORKSPACE/today-mem.py" 2>/dev/null || "$WORKSPACE/today-mem"
    ;;
  search)
    query="${1:-}"
    if [ -z "$query" ]; then
      echo "Error: search requires a query string" >&2
      echo "Usage: quick search <query>" >&2
      exit 1
    fi
    "$WORKSPACE/msearch" "$query" 2>/dev/null || python3 -m pip install --quiet ripgrep 2>/dev/null; "$WORKSPACE/msearch" "$query"
    ;;
  health)
    python3 "$WORKSPACE/workspace-health.py" 2>/dev/null || "$WORKSPACE/workspace-health"
    ;;
  holidays)
    python3 "$WORKSPACE/show-holidays" 2>/dev/null || "$WORKSPACE/show-holidays"
    ;;
  git-status)
    git -C "$WORKSPACE" status --short
    ;;
  anime)
    "$WORKSPACE/anime-companion" "$@"
    ;;
  log)
    # Prefer structured JSON logger if available, fallback to simple logger
    if [ -x "$WORKSPACE/log-event-json" ]; then
      "$WORKSPACE/log-event-json" "$@"
    else
      "$WORKSPACE/log-event" "$@"
    fi
    ;;
  summarize)
    "$WORKSPACE/summarize-day" "$@"
    ;;
  email-clean)
    python3 "$WORKSPACE/email-cleaner.py" "$@"
    ;;
  help|--help|-h)
    show_help
    ;;
  *)
    echo "Error: Unknown command '$cmd'" >&2
    echo "Run 'quick help' for available commands." >&2
    exit 1
    ;;
esac
