#!/bin/bash
# Show git branches with last commit info
# Usage: ./quick git-branches

set -euo pipefail

WORKSPACE="/home/ubuntu/.openclaw/workspace"

cd "$WORKSPACE"

echo "=== Git Branches ==="
echo ""

current=$(git branch --show-current 2>/dev/null || echo "")

echo "Local branches:"
git branch | sed 's/^[*] */  /' | while IFS= read -r branch; do
  branch="${branch#"  "}"
  [ -z "$branch" ] && continue
  if [ "$branch" = "$current" ]; then
    last=$(git log -1 --pretty=format:"%h %cr %s" "$branch" 2>/dev/null || echo "no commits")
    echo "  * $branch (current) → $last"
  else
    last=$(git log -1 --pretty=format:"%h %cr %s" "$branch" 2>/dev/null || echo "no commits")
    echo "    $branch → $last"
  fi
done

echo ""
echo "Remote branches:"
git branch -r | sed 's/^[[:space:]]*//' | while IFS= read -r branch; do
  last=$(git log -1 --pretty=format:"%h %cr %s" "$branch" 2>/dev/null || echo "no commits")
  echo "    $branch → $last"
done

echo ""
echo "Use: git checkout <branch> to switch"
